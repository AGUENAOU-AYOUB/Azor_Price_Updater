{% extends 'base.html' %}
{% block content %}
<div class="card p-4 shadow-sm">
  <h3 class="mb-3">Percentage Price Update</h3>
  <div class="input-group mb-3">
    <input id="percent" class="form-control" type="number" step="0.01" placeholder="Enter percentage">
    <button id="start" class="btn btn-brand">Run</button>
  </div>
  <pre id="log" class="mt-3 p-2" style="height:300px;overflow:auto;"></pre>
</div>
{% endblock %}
{% block scripts %}
<script>
  document.getElementById('start').onclick = function(){
    const p = document.getElementById('percent').value;
    const log = document.getElementById('log');
    log.textContent='';
    const es = new EventSource(`/stream/percentage?percent=${encodeURIComponent(p)}`);
    es.onmessage = e => {
      if(e.data === '--done--') es.close();
      else log.textContent += e.data + '\n';
      log.scrollTop = log.scrollHeight;
    };
  };
</script>
{% endblock %}
